<!DOCTYPE html>
<html>
<head>
    <title>Item Details</title>
    <meta charset = "UTF-8">
    <style>
        table {
            border: 5px solid #000000;
            width: 800px;
            height: 800px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <table id="status">
        <tr>
            <th colspan="2">
                NOW STATUS
            </th>
        </tr>
        <tr>
            <td><button id="on_button">ON</button></td>
            <td><button id="off_button">OFF</button></td>
        </tr>
    </table>
    <script type="text/javascript">
        // ID FOR SHOWING CURRENT STATUS
        const status = document.getElementById("status");
        // ID FOR BUTTON
        const on = document.getElementById("on_button");
        const off = document.getElementById("off_button");

        // CREATE WEBSOCKET CONN
        const socket = new WebSocket("ws://192.168.45.226:8000/ws");

        // VAR ABOUT VIBE
        var exec = false;

        // CONDITION ABOUT EXECUTING VIBRATION
        function vibe(exec, time) {
            if (exec) {
                window.navigator.vibrate(time);
            }
        }
        
        // WINDOW.NAVIGATOR.VIBRATE() NEED TO INTERACTING USER
        // ON VIBRATION FUNCTION
        on.addEventListener("click", function() {
            exec = true;
        });
        // OFF VIBRATION FUNCTION
        off.addEventListener("click", function() {
            exec = false;
        });

        // RECEIVE PIR SENSOR VALUE
        socket.addEventListener("message", function(event) {
            // PRINT FOR DEBUG
            console.log("received message: ", event.data);
            const data = JSON.parse(event.data)
            const anybodyThere = data.anybodyThere;

            // PRINT FOR DEBUG
            console.log(typeof anybodyThere);
            console.log(anybodyThere);

            // SHOW STATUS WITH PIR SENSOR DATA
            if (anybodyThere === 1) {
                status.style.backgroundColor = "red";
                vibe(exec, 700);
            } else {
                status.style.backgroundColor = "white";
                vibe(exec, 0);
            }
        });

        // HANDLE SOCKET ERROR
        socket.addEventListener("error", function(event) {
            console.error("WebSocket ERROR: ", event);
        });

        // HANDLE SOCKET CLOSE
        socket.addEventListener("close", function(event) {
            console.error("WebSocket CLOSE: ", event);
        });
    </script>
</body>